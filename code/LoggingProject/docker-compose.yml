version: '3.8'

services:
  django:
    build: .
    ports:
      - "8000:8000"
    volumes:
      # Mount SSH key (create this directory and add your key)
      - ./ssh_keys:/root/.ssh:ro
    environment:
      # SSH tunnel configuration
      - DB_HOST=127.0.0.1          # Remote database host (on the SSH server)
      - DB_PORT=3306               # Remote database port (actual MySQL port)
      - LOCAL_PORT=3307            # Local port to tunnel to
      - SSH_USER=passthrough       # SSH username
      - SSH_HOST=98.84.13.90       # SSH server
      - SSH_PORT=22                # SSH port (default)
      - SSH_KEY_PATH=/root/.ssh/id_rsa
      
      # AutoSSH configuration (optional - these are defaults)
      - AUTOSSH_POLL=60
      - AUTOSSH_GATETIME=30
      - AUTOSSH_FIRST_POLL=30
      
      # Django database configuration
      - DATABASE_HOST=localhost
      - DATABASE_PORT=3307
      - DATABASE_NAME=swiftexam
      - DATABASE_USER=TA
      - DATABASE_PASSWORD=SwiftExam_pass1
      
    # Add capabilities for SSH
    cap_add:
      - NET_ADMIN
    
    # Restart policy
    restart: unless-stopped