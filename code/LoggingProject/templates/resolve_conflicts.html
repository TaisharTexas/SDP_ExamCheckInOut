{% extends "base.html" %}
{% load static %}

{% block title %}Resolve Name Conflicts{% endblock %}
{% block content %}

<div class="max-w-3xl mx-auto my-12 bg-white p-6 rounded-lg shadow">
    <h1 class="text-2xl font-bold text-gray-800 mb-6">Resolve Name Conflicts</h1>

    <form method="POST" action="{% url 'resolve_conflicts' %}" id="conflictForm">
        {% csrf_token %}
        <input type="hidden" name="course_id" value="{{ course.id }}">

        {% for conflict in conflicts %}
            <div class="mb-7 mt-5 bg-yellow-50 border border-yellow-300 text-yellow-800 px-6 py-4 rounded shadow-md w-full text-left relative">
                <h2 class="text-lg font-semibold mb-2">Name Conflict Detected</h2>
                <p class="mb-3">
                    Student ID <strong>{{ conflict.student_id }}</strong> already exists but has a name mismatch.
                </p>
                <ul class="mb-3">
                    <li><strong>Current in DB:</strong> {{ conflict.db_fname }} {{ conflict.db_lname }}</li>
                    <li><strong>Submitted (CSV):</strong> {{ conflict.incoming_fname }} {{ conflict.incoming_lname }}</li>
                </ul>

                <div class="flex flex-col sm:flex-row gap-3">
                    <!-- Option 1: Keep DB Name -->
                    <label class="flex-1">
                        <input type="radio" name="conflict_{{ conflict.student_id }}" value="keep_existing" required class="mr-2">
                        <span class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded transition duration-200 inline-block cursor-pointer">
                            ðŸ›‘ Keep Existing Name
                        </span>
                    </label>

                    <!-- Option 2: Use Submitted Name -->
                    <label class="flex-1">
                        <input type="radio" name="conflict_{{ conflict.student_id }}" value="use_new" class="mr-2">
                        <span class="bg-[#00B388] hover:bg-[#019774] text-white px-4 py-2 rounded transition duration-200 inline-block cursor-pointer">
                            âœ… Use Submitted Name
                        </span>
                    </label>

                    <!-- Hidden fields for submitted names -->
                    <input type="hidden" name="fname_{{ conflict.student_id }}" value="{{ conflict.incoming_fname }}">
                    <input type="hidden" name="lname_{{ conflict.student_id }}" value="{{ conflict.incoming_lname }}">
                </div>
            </div>
        {% endfor %}

        <div class="flex flex-col sm:flex-row gap-4 justify-center items-center mt-8">
            <!-- Keep All DB Names Button -->
            <button type="button" onclick="selectAll('keep_existing')" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded shadow">
                ðŸ›‘ Keep All DB Names
            </button>

            <!-- Use All CSV Names Button -->
            <button type="button" onclick="selectAll('use_new')" class="bg-[#00B388] hover:bg-[#019774] text-white px-6 py-2 rounded shadow">
                âœ… Use All CSV Names
            </button>
        </div>

        <div class="mt-8">
            <button type="submit" class="bg-[#00B388] hover:bg-[#019774] text-white px-6 py-2 rounded shadow">
                Resolve & Enroll
            </button>
        </div>
    </form>
</div>

{% endblock %}

{% block scripts %}
<script>
    function selectAll(choice) {
        const form = document.getElementById('conflictForm');
        const radios = form.querySelectorAll(`input[type="radio"][value="${choice}"]`);
        radios.forEach(radio => {
            radio.checked = true;
        });
    }
</script>
{% endblock %}